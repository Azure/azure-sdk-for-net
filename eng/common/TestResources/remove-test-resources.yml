# Removes resources from a cloud type specified by the variable (not parameter)
# 'CloudType'. Use this as part of a matrix to remove resources from a
# particular cloud instance.
# Assumes steps in deploy-test-resources.yml was run previously. Requires
# environment variable: AZURE_RESOURCEGROUP_NAME and Az PowerShell module

steps:
  - pwsh: >
      eng/common/TestResources/Remove-TestResources.ps1
      -ResourceGroupName "${env:AZURE_RESOURCEGROUP_NAME}"
      -TenantId '$(aad-azure-sdk-test-tenant-id)'
      -ProvisionerApplicationId '$(aad-azure-sdk-test-client-id)'
      -ProvisionerApplicationSecret '$(aad-azure-sdk-test-client-secret)'
      -Environment 'AzureCloud'
      -Force
      -Verbose
    displayName: Remove test resources (public)
    condition: and(ne(variables['AZURE_RESOURCEGROUP_NAME'], ''), eq(variables['CloudType'], 'public'))
    continueOnError: true

  - pwsh: >
      eng/common/TestResources/Remove-TestResources.ps1
      -ResourceGroupName "${env:AZURE_RESOURCEGROUP_NAME}"
      -TenantId '$(aad-azure-sdk-test-tenant-id-gov)'
      -ProvisionerApplicationId '$(aad-azure-sdk-test-client-id-gov)'
      -ProvisionerApplicationSecret '$(aad-azure-sdk-test-client-secret-gov)'
      -Environment 'AzureUSGovernment'
      -Force
      -Verbose
    displayName: Remove test resources (gov)
    condition: and(ne(variables['AZURE_RESOURCEGROUP_NAME'], ''), eq(variables['CloudType'], 'gov'))
    continueOnError: true

  - pwsh: >
      eng/common/TestResources/Remove-TestResources.ps1
      -ResourceGroupName "${env:AZURE_RESOURCEGROUP_NAME}"
      -TenantId '$(aad-azure-sdk-test-tenant-id-cn)'
      -ProvisionerApplicationId '$(aad-azure-sdk-test-client-id-cn)'
      -ProvisionerApplicationSecret '$(aad-azure-sdk-test-client-secret-cn)'
      -Environment 'AzureChinaCloud'
      -Force
      -Verbose
    displayName: Remove test resources (cn)
    condition: and(ne(variables['AZURE_RESOURCEGROUP_NAME'], ''), eq(variables['CloudType'], 'cn'))
    continueOnError: true
