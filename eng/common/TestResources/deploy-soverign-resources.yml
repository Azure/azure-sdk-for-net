# Deploys resources to a cloud type specified by the variable (not parameter)
# 'CloudType'. Use this as part of a matrix to deploy resources to a particular
# cloud instance.

parameters:
  ServiceDirectory: not-set
  AdditionalParameters: ''
  Location: 'westus2'

steps:
  # New-TestResources command requires Az module
  - pwsh: Install-Module -Name Az -Scope CurrentUser -AllowClobber -Force -Verbose
    displayName: Install Azure PowerShell module

  - template: ../../../common/TestResources/deploy-test-resources.yml
    parameters:
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      TenantId: $(aad-azure-sdk-test-tenant-id)
      TestApplicationId: $(aad-azure-sdk-test-client-id)
      TestApplicationSecret: $(aad-azure-sdk-test-client-secret)
      TestApplicationObjectId: $(aad-azure-sdk-test-client-oid)
      ProvisionerApplicationId: $(provisioner-aad-id)
      ProvisionerApplicationSecret: $(provisioner-aad-secret)
      AdditionalParameters: ${{ parameters.AdditionalParameters }}
      Location: ${{ parameters.Location }}
      Environment: AzureCloud
      Condition: and(succeeded(), eq(variables['CloudType'], 'public'))
      BoostrapAzModule: false

  - template: ../../../common/TestResources/deploy-test-resources.yml
    parameters:
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      TenantId: $(aad-azure-sdk-test-tenant-id-gov)
      TestApplicationId: $(aad-azure-sdk-test-client-id-gov)
      TestApplicationSecret: $(aad-azure-sdk-test-client-secret-gov)
      TestApplicationObjectId: $(aad-azure-sdk-test-client-oid-gov)
      ProvisionerApplicationId: $(provisioner-aad-id-gov)
      ProvisionerApplicationSecret: $(provisioner-aad-secret-gov)
      AdditionalParameters: ${{ parameters.AdditionalParameters }}
      Location: ${{ parameters.Location }}
      Environment: AzureUSGovernment
      Condition: and(succeeded(), eq(variables['CloudType'], 'gov'))
      BoostrapAzModule: false

  - template: ../../../common/TestResources/deploy-test-resources.yml
    parameters:
      ServiceDirectory: ${{ parameters.ServiceDirectory }}
      TenantId: $(aad-azure-sdk-test-tenant-id-cn)
      TestApplicationId: $(aad-azure-sdk-test-client-id-cn)
      TestApplicationSecret: $(aad-azure-sdk-test-client-secret-cn)
      TestApplicationObjectId: $(aad-azure-sdk-test-client-oid-cn)
      ProvisionerApplicationId: $(provisioner-aad-id-cn)
      ProvisionerApplicationSecret: $(provisioner-aad-secret-cn)
      AdditionalParameters: ${{ parameters.AdditionalParameters }}
      Location: ${{ parameters.Location }}
      Environment: AzureChinaCloud
      Condition: and(succeeded(), eq(variables['CloudType'], 'cn'))
      BoostrapAzModule: false