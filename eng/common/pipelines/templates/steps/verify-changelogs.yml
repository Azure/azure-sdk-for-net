parameters:
- name: PackagePropertiesFolder
  type: string
- name: Condition
  type: string
  default: succeeded()

steps:
  - pwsh: |
      Get-ChildItem -Recurse -Path "$(Build.SourcesDirectory)/sdk" -Include ci.yml `
        | % { Get-Content $_ | yq -o=json > "$($_.FullName).json" }
    displayName: Generate ci.yml.json
    condition: ${{ parameters.Condition }}

  - task: Powershell@2
    inputs:
      filePath: $(Build.SourcesDirectory)/eng/common/scripts/Verify-ChangeLogs.ps1
      arguments: >
        -PackagePropertiesFolder '${{ parameters.PackagePropertiesFolder }}'
      pwsh: true
    displayName: Verify ChangeLogEntries
    condition: ${{ parameters.Condition }}
