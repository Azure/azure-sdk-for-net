// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// <auto-generated/>

#nullable disable

using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Azure;

namespace MgmtTypeSpec
{
    internal partial class AsyncPageableWrapper<T, U> : AsyncPageable<U>
    {
        /// <summary> The source async pageable value of type AsyncPageable&lt;T&gt;. </summary>
        private AsyncPageable<T> _source;
        /// <summary> The converter function from T to U. </summary>
        private Func<T, U> _converter;

        /// <summary> Initializes a new instance of the AsyncPageableWrapper class. </summary>
        /// <param name="source"> The source async pageable value of type AsyncPageable&lt;T&gt;. </param>
        /// <param name="converter"> The converter function from T to U. </param>
        public AsyncPageableWrapper(AsyncPageable<T> source, Func<T, U> converter)
        {
            _source = source;
            _converter = converter;
        }

        /// <summary> Converts the pages from AsyncPageable to Page. </summary>
        /// <param name="continuationToken"> A continuation token from a previous response. </param>
        /// <param name="pageSizeHint"> An optional hint to specify the desired size of each page. </param>
        /// <returns> An enumerable of pages containing converted items of type U. </returns>
        public override async IAsyncEnumerable<Page<U>> AsPages(string continuationToken, int? pageSizeHint)
        {
            await foreach (Page<T> page in _source.AsPages(continuationToken, pageSizeHint).ConfigureAwait(false))
            {
                List<U> convertedItems = new List<U>();
                foreach (T item in page.Values)
                {
                    convertedItems.Add(_converter.Invoke(item));
                }
                yield return Page<U>.FromValues(convertedItems, page.ContinuationToken, page.GetRawResponse());
            }
        }
    }
}
