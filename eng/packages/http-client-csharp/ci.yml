trigger: none
pr:
  branches:
    include:
    - main
    - feature/*
    - hotfix/*
    - release/*
  paths:
    include:
    - eng/packages/http-client-csharp

parameters:
  - name: BuildPrereleaseVersion
    displayName: 'Build prerelease version'
    type: boolean
    default: true
  - name: ShouldRegenrate
    displayName: 'Should regenerate'
    type: boolean
    default: true
  - name: UseTypeSpecNext
    displayName: 'Use TypeSpec Next'
    type: boolean
    default: false
  - name: PublishTo
    displayName: 'Publish to'
    type: string
    default: 'devops'
    values: ['none', 'devops', 'public']

extends:
  template: /eng/common/pipelines/templates/archetype-typespec-emitter.yml
  parameters:
    BuildPrereleaseVersion: ${{ parameters.BuildPrereleaseVersion }}
    UseTypeSpecNext: ${{ parameters.UseTypeSpecNext }}
    ${{ if eq(variables['System.TeamProject'], 'internal') }}:
      ShouldPublish: ${{ ne(parameters.PublishTo, 'none') }}
      PublishPublic: ${{ eq(parameters.PublishTo, 'public') }}
      PublishDependsOnTest: ${{ eq(parameters.PublishTo, 'public') }}
      
      ShouldRegenrate: ${{ parameters.ShouldRegenrate }}
      RegenerationJobCount: 5
      MinimumPerJob: 10
      OnlyGenerateTypespec: true
    TestMatrix:
        All:
          TestArguments: -UnitTests -GenerationChecks -Filter .NET
