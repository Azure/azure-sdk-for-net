parameters:
- name: AdditionalPlatforms
  type: object
  default: []
- name: PreSteps
  type: object
  default: []
- name: PostSteps
  type: object
  default: []
- name: EnvVars
  type: object
  default: {}
- name: MaxParallel
  type: number
  default: 0
- name: BuildInParallel
  type: boolean
  default: true
- name: TimeoutInMinutes
  type: number
  default: 60
- name: Location
  type: string
  default: ''
- name: SubscriptionConfiguration
  type: string
  default: $(sub-config-azure-cloud-test-resources)
- name: ServiceDirectory
  type: string
  default: not-specified

jobs:
- template: archetype-sdk-tests-jobs.yml
  parameters:
    PreSteps: ${{ parameters.PreSteps }}
    PostSteps: ${{ parameters.PostSteps }}
    EnvVars: ${{ parameters.EnvVars }}
    MaxParallel: ${{ parameters.MaxParallel }}
    BuildInParallel: ${{ parameters.BuildInParallel }}
    TimeoutInMinutes: ${{ parameters.TimeoutInMinutes }}
    Location: ${{ parameters.Location }}
    SubscriptionConfiguration: ${{ parameters.SubscriptionConfiguration }}
    ServiceDirectory: ${{ parameters.ServiceDirectory }}
    platforms:
      - DisplayName: "Linux"
        OSVmImage: "ubuntu-18.04"
        TestTargetFramework: netcoreapp2.1
      - DisplayName: "Windows NetCoreApp"
        OSVmImage: "windows-2019"
        TestTargetFramework: netcoreapp2.1
      - DisplayName: "Windows NetCoreApp ProjectReferences"
        OSVmImage: "windows-2019"
        TestTargetFramework: netcoreapp2.1
        ConvertToProjectReferenceOption: /p:UseProjectReferenceToAzureClients=true
      - DisplayName: "Windows NetFramework"
        OSVmImage: "windows-2019"
        TestTargetFramework: net461
      - DisplayName: "Windows NetFramework ProjectReferences"
        OSVmImage: "windows-2019"
        TestTargetFramework: net461
        ConvertToProjectReferenceOption: /p:UseProjectReferenceToAzureClients=true
      - DisplayName: "MacOS"
        OSVmImage: "macOS-10.15"
        TestTargetFramework: netcoreapp2.1
      - ${{ parameters.AdditionalPlatforms }}
