steps:
  - task: DotNetCoreInstaller@2
    displayName: "Use .NET Core sdk $(DotNetCoreSDKVersion)"
    inputs:
      version: $(DotNetCoreSDKVersion)
  - task: UsePythonVersion@0
    displayName: 'Use Python 3.6'
    inputs:
      versionSpec: '3.6'
  - template: eng/pipelines/templates/scripts/replace-relative-links.yml@azure-sdk-tools
    parameters:
      TargetFolder: '.'
      RootFolder: '.'
      BuildSHA: $(Build.SourceVersion)
      RepoId: 'Azure/azure-sdk-for-net'
  - pwsh: |
      . $(Build.SourcesDirectory)/doc/ApiDocGeneration/Generate-Api-Docs.ps1
      Get-DocTools -DownloadDirectory $(Build.BinariesDirectory) -RepoRoot $(Build.SourcesDirectory)
    displayName: Download and Extract Required Software

  - ${{ each artifact in parameters.Artifacts }}:
    - pwsh: |
        . $(Build.SourcesDirectory)/doc/ApiDocGeneration/Generate-Api-Docs.ps1
        Build-Docs -ArtifactName '${{artifact.name}}' -ServiceDirectory '${{parameters.ServiceDirectory}}' `
        -ArtifactsSafeName '${{artifact.safeName}}' -ArtifactsDirectoryName '${{artifact.directoryName}}' `
        -LibType '${{parameters.LibType}}' -RepoRoot $(Build.SourcesDirectory) -BinDirectory $(Build.BinariesDirectory)
      displayName: Build DocFx Documenttion Site for ${{artifact.name}}
    - task: PublishPipelineArtifact@0
      condition: succeeded()
      inputs:
        artifactName: Docs.${{artifact.name}}
        targetPath: $(Build.BinariesDirectory)/$(artifactsafename)/docfx-output/docfx_project/_site