parameters:
  ServiceDirectory: ''
  AOTTestInputs: []

steps:
- ${{ each aotTestInput in parameters.AOTTestInputs }}:
  - task: Powershell@2
    displayName: Check for AOT compatibility regressions in ${{ aotTestInput.ArtifactName }}
    inputs:
      targetType: filepath
      filePath: $(Build.SourcesDirectory)/eng/scripts/aotcompatibility/Check-AOT-Compatibility.ps1
    ${{ if eq(length(aotTestInput), 1) }}:
      arguments: >-
        -ServiceDirectory ${{ parameters.ServiceDirectory }}
        -PackageName ${{ aotTestInput.ArtifactName }}
    ${{ if eq(length(aotTestInput), 2) }}:
      arguments: >-
        -ServiceDirectory ${{ parameters.ServiceDirectory }}
        -PackageName ${{ aotTestInput.ArtifactName }}
        -ExpectedWarningsFilePath ${{ aotTestInput.ExpectedWarningsFilePath }}
      workingDirectory: $(Build.SourcesDirectory)/eng/scripts/aotcompatibility