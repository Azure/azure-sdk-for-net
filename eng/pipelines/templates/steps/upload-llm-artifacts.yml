# This template serves as a place to upload artifacts intended to be used by LLMs
# that handle data from the pipeline (for example github copilot).

steps:
  - pwsh: |
      $artifactsDirectory = "$(Build.ArtifactStagingDirectory)/llm-artifacts"
      New-Item $artifactsDirectory -ItemType directory -Force

      Write-Host "================="
      Get-ChildItem -Path $(TestTargetFramework)*.trx -Recurse -File
      Write-Host "================="

      foreach($testResultsFile in (Get-ChildItem -Path $(TestTargetFramework)*.trx -Recurse -File))
      {
        $fileFullName = $testResultsFile.FullName
        $fileName = $testResultsFile.Name
        New-Item "$artifactsDirectory/$(System.JobName)" -ItemType directory -Force
        Move-Item -Path $fileFullName -Destination "$artifactsDirectory/$(System.JobName)/$fileName" -ErrorAction Continue
        Write-Host "##vso[task.setvariable variable=uploadTestResults]true"
      }
    condition: succeededOrFailed()
    displayName: Copy test results files to llm artifacts staging directory
