parameters:
  ArtifactPath: $(Build.ArtifactStagingDirectory)
  Artifacts: []

steps:
  - ${{ each artifact in parameters.Artifacts }}:
    - task: Powershell@2
      inputs:
        filePath: $(Build.SourcesDirectory)/eng/scripts/Create-APIReview.ps1
        arguments: >
          -ArtifactPath ${{parameters.ArtifactPath}}/${{artifact.name}}
          -APIViewUri $(azuresdk-apiview-uri)
          -APIKey $(azuresdk-apiview-apikey)
          -APILabel "Auto Review - $(Build.SourceVersion)"
        pwsh: true
        workingDirectory: $(Pipeline.Workspace)
      displayName: Create API Review ${{ artifact.name}}
      condition: and(succeededOrFailed(), ne(variables['Skip.CreateApiReview'], 'true') , ne(variables['Build.Reason'],'PullRequest'), eq(variables['System.TeamProject'], 'internal'))
      continueOnError: true