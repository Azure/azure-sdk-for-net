steps:
  - pwsh: |
      $dump = Get-ChildItem -Path $(Build.SourcesDirectory) -Include *.dmp -Recurse |Select -First 1
      if ($dump)
      {
        Write-Host "##vso[task.setvariable variable=uploadDump]true"
        Write-Host "##vso[task.setvariable variable=dumpPath]$dump"
      }
      condition: failed()
      displayName: Search for crash dump
  - task: PublishPipelineArtifact@1
      condition: eq(variables['uploadDump'], 'true')
      displayName: Upload crash dump
      inputs:
      targetPath: $(dumpPath)
      artifactName: "Crash Dump - $(OSName) $(TestTargetFramework) - $(System.JobId)"
