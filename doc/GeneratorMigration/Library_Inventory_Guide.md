# Azure SDK for .NET Library Inventory Guide

This document outlines how to generate and maintain the inventory of libraries in the Azure SDK for .NET repository.

## Purpose

The library inventory helps us:

1. Track all Azure.* libraries in the repository (legacy non-Azure.* libraries are excluded)
2. Categorize them as data plane or management plane
3. Identify which generator (New Emitter, Autorest, or Old TypeSpec) they use
4. Plan migrations to newer generators

## Generating the Inventory

To generate the library inventory:

1. Run the `Library_Inventory.ps1` script from the repository root:

```powershell
pwsh doc/GeneratorMigration/Library_Inventory.ps1
```

2. The script will:
   - Scan all libraries in the `sdk/` directory
   - Filter out libraries that don't start with "Azure.*" (legacy libraries)
   - Categorize them by type (data plane or management plane)
   - Identify the generator used (New Emitter, Autorest, or Old TypeSpec)
   - Generate a markdown report (`doc/GeneratorMigration/Library_Inventory.md`)

3. If you need JSON output for programmatic use, use the `-Json` flag:

```powershell
pwsh doc/GeneratorMigration/Library_Inventory.ps1 -Json
```
   - This will generate an additional `Library_Inventory.json` file with the raw inventory data
   - Note: The JSON file is for temporary analytical use and should not be checked into the repository

## Inventory Classification Logic

The script uses the following logic to categorize libraries:

### Data Plane vs Management Plane

- **Management Plane**: Libraries that contain "Azure.ResourceManager" or ".Management." in their path
- **Data Plane**: All other libraries

### Swagger vs TypeSpec (TSP)

The script looks for evidence of TypeSpec usage in the following order:

1. Direct TypeSpec indicators:
   - `tsp-location.yaml` file with an `emitterPackageJsonPath` value
   - `src/tspconfig.yaml` file
   - `src/tsp` directory
   - `.tsp` files in the src directory

2. Swagger indicators:
   - Presence of `src/autorest.md` file
   - `src/Generated` directory exists
   - Files with `<auto-generated/>` comment headers

If none of these TypeSpec indicators are found but there is evidence of code generation 
(like a `src/Generated` directory or files with `<auto-generated/>` markers), the script assumes Swagger.

## Understanding the Results

The inventory markdown file provides:

1. Overall summary counts with breakdown by generator type
2. Four main tables for migrated libraries:
   - **Data Plane Libraries (DPG) - Migrated to New Emitter**: Client APIs migrated to new TypeSpec
     - Columns: Service, Library, New Emitter, Autorest
     - Includes migration status (e.g., "16 / 169 (9.5%)")
   - **Management Plane Libraries (MPG) - Migrated to New Emitter**: Resource management APIs migrated to new TypeSpec
     - Columns: Service, Library, New Emitter, Autorest
     - Includes migration status (e.g., "24 / 226 (10.6%)")
3. Two tables for libraries still on Swagger:
   - **Data Plane Libraries (DPG) - Still on Swagger**: Libraries not yet migrated
     - Columns: Service, Library (no generator columns needed)
   - **Management Plane Libraries (MPG) - Still on Swagger**: Libraries not yet migrated
     - Columns: Service, Library (no generator columns needed)
4. Libraries with no generator (listed separately)

The migrated tables use green checkmarks (ðŸŸ¢) to indicate the generator type:
- **New Emitter** column: Libraries using new TypeSpec emitters (@azure-typespec/http-client-csharp, @azure-typespec/http-client-csharp-mgmt, or @typespec/http-client-csharp)
- **Autorest** column: Libraries using Swagger/Autorest
- **No checkmarks**: Libraries using old TypeSpec (TSP-Old) or no generator

The migration status shows the number of libraries migrated to the new emitter out of the total, along with the percentage.

## Updating the Inventory

The inventory should be updated whenever:

1. New libraries are added to the repository
2. Libraries are migrated from Swagger to TypeSpec
3. Preparing for migration planning

Simply run the script again to regenerate the inventory files.