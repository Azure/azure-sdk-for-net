trigger:
- psSdkJson6

# Variables:
#  'targetSDK' the dataPlane SDK you want to build (Ex: KeyVault)
#  'scope' should be set in the pipeline definition to 'SDKs/$(targetSDK)/dataPlane'
#  'build.useLatest' indicates whether or not to use build bootstrap files from the LTSBuildTools branch

jobs:
  - job: 'Build_Packages'

    pool:
      vmImage: 'vs2017-win2016'

    steps:
      - script: dotnet pack src/SDKs/DataPlane.proj /p:PackageOutputPath=$(Build.ArtifactStagingDirectory)
        displayName: 'Build & Package'

      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifacts'

  - job: 'Test_Windows'

    pool:
      vmImage: 'vs2017-win2016'

    steps:
      - script: dotnet test src/SDKs/DataPlaneTests.proj
        displayName: 'Build & Test'

      - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
        displayName: 'Component Detection'
        # ComponentGovernance is currently unable to run on pull requests of public projects.  Running on
        # scheduled builds should be good enough.
        condition: and(succeeded(), eq(variables['Build.Reason'], 'Schedule'))

  - job: 'Test_Linux'

    pool:
      vmImage: 'ubuntu-16.04'

    steps:
      - script: dotnet test src/SDKs/DataPlaneTests.proj
        displayName: 'Build & Test'
