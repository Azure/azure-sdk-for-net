// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// <auto-generated/>

#nullable disable

using System;
using System.Collections.Generic;
using System.Net;
using System.Threading.Tasks;
using Azure.Core.TestFramework;
using Azure.ResourceManager.Compute;
using Azure.ResourceManager.Compute.Models;
using Azure.ResourceManager.Resources;
using Azure.ResourceManager.Resources.Models;
using Azure.ResourceManager.TestFramework;

namespace Azure.ResourceManager.Compute.Tests.Mock
{
    /// <summary> Test for VirtualMachine. </summary>
    public partial class VirtualMachineMockTests : MockTestBase
    {
        public VirtualMachineMockTests(bool isAsync) : base(isAsync, RecordedTestMode.Record)
        {
            ServicePointManager.ServerCertificateValidationCallback += (sender, cert, chain, sslPolicyErrors) => true;
            Environment.SetEnvironmentVariable("RESOURCE_MANAGER_URL", $"https://localhost:8443");
        }

        private async Task<Compute.VirtualMachineCollection> GetVirtualMachineCollectionAsync(string resourceGroupName)
        {
            ResourceGroup resourceGroup = await TestHelper.CreateResourceGroupAsync(resourceGroupName, GetArmClient());
            VirtualMachineCollection virtualMachineCollection = resourceGroup.GetVirtualMachines();
            return virtualMachineCollection;
        }

        private async Task<Compute.VirtualMachine> GetVirtualMachineAsync()
        {
            var collection = await GetVirtualMachineCollectionAsync("myResourceGroup");
            var createOperation = await TestHelper.CreateOrUpdateExampleInstanceAsync(collection, "myVM");
            return createOperation.Value;
        }

        [RecordedTest]
        public async Task GetAsync()
        {
            // Example: Get a Virtual Machine.
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.InstanceViewTypes? expand = null;

            await virtualMachine.GetAsync(expand);
        }

        [RecordedTest]
        public async Task GetAsync2()
        {
            // Example: Get a virtual machine placed on a dedicated host group through automatic placement
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.InstanceViewTypes? expand = null;

            await virtualMachine.GetAsync(expand);
        }

        [RecordedTest]
        public async Task DeleteAsync()
        {
            // Example: Force delete a VM
            var virtualMachine = await GetVirtualMachineAsync();
            bool? forceDeletion = true;

            await virtualMachine.DeleteAsync(forceDeletion);
        }

        [RecordedTest]
        public async Task UpdateAsync()
        {
            // Example: Update a VM by detaching data disk
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.VirtualMachineUpdate parameters = new Compute.Models.VirtualMachineUpdate()
            {
                HardwareProfile = new Compute.Models.HardwareProfile()
                {
                    VmSize = new Compute.Models.VirtualMachineSizeTypes("Standard_D2_v2"),
                },
                StorageProfile = new Compute.Models.StorageProfile()
                {
                    ImageReference = new Compute.Models.ImageReference()
                    {
                        Publisher = "MicrosoftWindowsServer",
                        Offer = "WindowsServer",
                        Sku = "2016-Datacenter",
                        Version = "latest",
                    },
                    OsDisk = new Compute.Models.OSDisk(new Compute.Models.DiskCreateOptionTypes("FromImage"))
                    {
                        Name = "myVMosdisk",
                        Caching = Compute.Models.CachingTypes.ReadWrite,
                        ManagedDisk = new Compute.Models.ManagedDiskParameters()
                        {
                            StorageAccountType = new Compute.Models.StorageAccountTypes("Standard_LRS"),
                        },
                    },
                },
                OsProfile = new Compute.Models.OSProfile()
                {
                    ComputerName = "myVM",
                    AdminUsername = "{your-username}",
                    AdminPassword = "{your-password}",
                },
                NetworkProfile = new Compute.Models.NetworkProfile(),
            };

            await virtualMachine.UpdateAsync(parameters);
        }

        [RecordedTest]
        public async Task UpdateAsync2()
        {
            // Example: Update a VM by force-detaching data disk
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.VirtualMachineUpdate parameters = new Compute.Models.VirtualMachineUpdate()
            {
                HardwareProfile = new Compute.Models.HardwareProfile()
                {
                    VmSize = new Compute.Models.VirtualMachineSizeTypes("Standard_D2_v2"),
                },
                StorageProfile = new Compute.Models.StorageProfile()
                {
                    ImageReference = new Compute.Models.ImageReference()
                    {
                        Publisher = "MicrosoftWindowsServer",
                        Offer = "WindowsServer",
                        Sku = "2016-Datacenter",
                        Version = "latest",
                    },
                    OsDisk = new Compute.Models.OSDisk(new Compute.Models.DiskCreateOptionTypes("FromImage"))
                    {
                        Name = "myVMosdisk",
                        Caching = Compute.Models.CachingTypes.ReadWrite,
                        ManagedDisk = new Compute.Models.ManagedDiskParameters()
                        {
                            StorageAccountType = new Compute.Models.StorageAccountTypes("Standard_LRS"),
                        },
                    },
                },
                OsProfile = new Compute.Models.OSProfile()
                {
                    ComputerName = "myVM",
                    AdminUsername = "{your-username}",
                    AdminPassword = "{your-password}",
                },
                NetworkProfile = new Compute.Models.NetworkProfile(),
            };

            await virtualMachine.UpdateAsync(parameters);
        }

        [RecordedTest]
        public async Task InstanceViewAsync()
        {
            // Example: Get Virtual Machine Instance View.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.InstanceViewAsync();
        }

        [RecordedTest]
        public async Task InstanceViewAsync2()
        {
            // Example: Get instance view of a virtual machine placed on a dedicated host group through automatic placement.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.InstanceViewAsync();
        }

        [RecordedTest]
        public async Task GeneralizeAsync()
        {
            // Example: Generalize a Virtual Machine.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.GeneralizeAsync();
        }

        [RecordedTest]
        public async Task GetAvailableSizesAsync()
        {
            // Example: Lists all available virtual machine sizes to which the specified virtual machine can be resized
            var virtualMachine = await GetVirtualMachineAsync();

            virtualMachine.GetAvailableSizesAsync();
        }

        [RecordedTest]
        public async Task ReapplyAsync()
        {
            // Example: Reapply the state of a virtual machine.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.ReapplyAsync();
        }

        [RecordedTest]
        public async Task ReimageAsync()
        {
            // Example: Reimage a Virtual Machine.
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.VirtualMachineReimageParameters parameters = new Compute.Models.VirtualMachineReimageParameters()
            {
                TempDisk = true,
            };

            await virtualMachine.ReimageAsync(parameters);
        }

        [RecordedTest]
        public async Task RetrieveBootDiagnosticsDataAsync()
        {
            // Example: RetrieveBootDiagnosticsData of a virtual machine.
            var virtualMachine = await GetVirtualMachineAsync();
            int? sasUriExpirationTimeInMinutes = 60;

            await virtualMachine.RetrieveBootDiagnosticsDataAsync(sasUriExpirationTimeInMinutes);
        }

        [RecordedTest]
        public async Task SimulateEvictionAsync()
        {
            // Example: Simulate Eviction a virtual machine.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.SimulateEvictionAsync();
        }

        [RecordedTest]
        public async Task AssessPatchesAsync()
        {
            // Example: Assess patch state of a virtual machine.
            var virtualMachine = await GetVirtualMachineAsync();

            await virtualMachine.AssessPatchesAsync();
        }

        [RecordedTest]
        public async Task InstallPatchesAsync()
        {
            // Example: Install patch state of a virtual machine.
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.VirtualMachineInstallPatchesParameters installPatchesInput = new Compute.Models.VirtualMachineInstallPatchesParameters("PT4H", new Compute.Models.VMGuestPatchRebootSetting("IfRequired"))
            {
                WindowsParameters = new Compute.Models.WindowsParameters()
                {
                    MaxPatchPublishDate = DateTimeOffset.Parse("2020-11-19T02:36:43.0539904+00:00"),
                },
            };

            await virtualMachine.InstallPatchesAsync(installPatchesInput);
        }

        [RecordedTest]
        public async Task RunCommandAsync()
        {
            // Example: VirtualMachineRunCommand
            var virtualMachine = await GetVirtualMachineAsync();
            Compute.Models.RunCommandInput parameters = new Compute.Models.RunCommandInput("RunPowerShellScript");

            await virtualMachine.RunCommandAsync(parameters);
        }
    }
}
