# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.

trigger:
  branches:
    include:
    - main
    - hotfix/*
    - release/*
  paths:
    include:
    - sdk/core/
    - eng/
    exclude:
    - eng/mgmt/
    - eng/common/

pr:
  branches:
    include:
    - main
    - feature/*
    - hotfix/*
    - release/*
  paths:
    include:
    - sdk/core/
    - sdk/testcommon/
    - eng/
    - samples/
    exclude:
    - eng/mgmt/
    - eng/common/

parameters:
  - name: Artifacts
    type: object
    default:
      - name: Azure.Core
        safeName: AzureCore
      - name: Azure.Core.Experimental
        safeName: AzureCoreExperimental
      - name: Azure.Core.Expressions.DataFactory
        safeName: AzureCoreExpressionsDataFactory
      - name: Microsoft.Azure.Core.NewtonsoftJson
        safeName: MicrosoftAzureCoreNewtonsoftJson
      - name: Microsoft.Azure.Core.Spatial
        safeName: MicrosoftAzureCoreSpatial
      - name: Microsoft.Azure.Core.Spatial.NewtonsoftJson
        safeName: MicrosoftAzureCoreSpatialNewtonsoftJson
        # Currently due to size constraints with 1es pipeline templates we cannot include ALL release stages in one build
        skipReleaseStage: true
      - name: Azure.Core.Amqp
        safeName: AzureCoreAmqp
        # Currently due to size constraints with 1es pipeline templates we cannot include ALL release stages in one build
        skipReleaseStage: true
      - name: System.ClientModel
        safeName: SystemClientModel

extends:
  template: /eng/pipelines/templates/stages/archetype-sdk-client.yml
  parameters:
    ServiceDirectory: core
    BuildSnippets: false
    ArtifactName: packages
    Artifacts: ${{ parameters.Artifacts }}
    CheckAOTCompat: true
    AOTTestInputs:
    - ArtifactName: Azure.Core
      ExpectedWarningsFilepath: /Azure.Core/tests/compatibility/ExpectedAotWarnings.txt

    TestSetupSteps:
    - template: /sdk/storage/tests-install-azurite.yml
    TestTimeoutInMinutes: 100
    TestDependsOnDependency: Azure.Core
