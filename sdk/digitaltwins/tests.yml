trigger: none

extends:
  template: ../../eng/pipelines/templates/stages/archetype-sdk-tests.yml
  parameters:
    ServiceDirectory: digitaltwins
    # Enable canary and public cloud testing in separate subscriptions, so that the tests-weekly builds
    # don't exceed the 10 azure digital twin instance hard limit
    CloudConfig:
      Public:
        SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources)
        Location: westus2
      Canary:
        SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources-preview)
        Location: eastus2euap
    Clouds: Public,Canary
    PreSteps:
      # Remove when https://github.com/actions/virtual-environments/pull/3655 is deployed to our macOS agents
      - pwsh: |
          if (!(Get-Command bicep -ErrorAction Ignore)) {
            brew tap azure/bicep
            brew install bicep
          }
        condition: contains(variables['OSVmImage'], 'mac')
        displayName: Ensure Bicep CLI is installed on macOS
