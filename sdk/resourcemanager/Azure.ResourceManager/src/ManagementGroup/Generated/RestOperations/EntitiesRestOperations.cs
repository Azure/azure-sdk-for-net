// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// <auto-generated/>

#nullable disable

using System;
using System.Text.Json;
using System.Threading;
using System.Threading.Tasks;
using Azure;
using Azure.Core;
using Azure.Core.Pipeline;
using Azure.ResourceManager.Core;
using Azure.ResourceManager.Management.Models;

namespace Azure.ResourceManager.Management
{
    internal partial class EntitiesRestOperations
    {
        private Uri endpoint;
        private string apiVersion;
        private ClientDiagnostics _clientDiagnostics;
        private HttpPipeline _pipeline;
        private readonly string _userAgent;

        /// <summary> Initializes a new instance of EntitiesRestOperations. </summary>
        /// <param name="clientDiagnostics"> The handler for diagnostic messaging in the client. </param>
        /// <param name="pipeline"> The HTTP pipeline for sending and receiving REST requests and responses. </param>
        /// <param name="options"> The client options used to construct the current client. </param>
        /// <param name="endpoint"> server parameter. </param>
        /// <param name="apiVersion"> Api Version. </param>
        /// <exception cref="ArgumentNullException"> <paramref name="apiVersion"/> is null. </exception>
        public EntitiesRestOperations(ClientDiagnostics clientDiagnostics, HttpPipeline pipeline, ClientOptions options, Uri endpoint = null, string apiVersion = "2021-04-01")
        {
            this.endpoint = endpoint ?? new Uri("https://management.azure.com");
            this.apiVersion = apiVersion ?? throw new ArgumentNullException(nameof(apiVersion));
            _clientDiagnostics = clientDiagnostics;
            _pipeline = pipeline;
            _userAgent = HttpMessageUtilities.GetUserAgentName(this, options);
        }

        internal HttpMessage CreateListRequest(string skiptoken, int? skip, int? top, string select, Enum2? search, string filter, Enum3? view, string groupName, string cacheControl)
        {
            var message = _pipeline.CreateMessage();
            var request = message.Request;
            request.Method = RequestMethod.Post;
            var uri = new RawRequestUriBuilder();
            uri.Reset(endpoint);
            uri.AppendPath("/providers/Microsoft.Management/getEntities", false);
            uri.AppendQuery("api-version", apiVersion, true);
            if (skiptoken != null)
            {
                uri.AppendQuery("$skiptoken", skiptoken, true);
            }
            if (skip != null)
            {
                uri.AppendQuery("$skip", skip.Value, true);
            }
            if (top != null)
            {
                uri.AppendQuery("$top", top.Value, true);
            }
            if (select != null)
            {
                uri.AppendQuery("$select", select, true);
            }
            if (search != null)
            {
                uri.AppendQuery("$search", search.Value.ToString(), true);
            }
            if (filter != null)
            {
                uri.AppendQuery("$filter", filter, true);
            }
            if (view != null)
            {
                uri.AppendQuery("$view", view.Value.ToString(), true);
            }
            if (groupName != null)
            {
                uri.AppendQuery("groupName", groupName, true);
            }
            request.Uri = uri;
            if (cacheControl != null)
            {
                request.Headers.Add("Cache-Control", cacheControl);
            }
            request.Headers.Add("Accept", "application/json");
            message.SetProperty("UserAgentOverride", _userAgent);
            return message;
        }

        /// <summary>
        /// List all entities (Management Groups, Subscriptions, etc.) for the authenticated user.
        /// 
        /// </summary>
        /// <param name="skiptoken">
        /// Page continuation token is only used if a previous operation returned a partial result. 
        /// If a previous response contains a nextLink element, the value of the nextLink element will include a token parameter that specifies a starting point to use for subsequent calls.
        /// 
        /// </param>
        /// <param name="skip"> Number of entities to skip over when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="top"> Number of elements to return when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="select"> This parameter specifies the fields to include in the response. Can include any combination of Name,DisplayName,Type,ParentDisplayNameChain,ParentChain, e.g. &apos;$select=Name,DisplayName,Type,ParentDisplayNameChain,ParentNameChain&apos;. When specified the $select parameter can override select in $skipToken. </param>
        /// <param name="search">
        /// The $search parameter is used in conjunction with the $filter parameter to return three different outputs depending on the parameter passed in. 
        /// With $search=AllowedParents the API will return the entity info of all groups that the requested entity will be able to reparent to as determined by the user&apos;s permissions.
        /// With $search=AllowedChildren the API will return the entity info of all entities that can be added as children of the requested entity.
        /// With $search=ParentAndFirstLevelChildren the API will return the parent and  first level of children that the user has either direct access to or indirect access via one of their descendants.
        /// With $search=ParentOnly the API will return only the group if the user has access to at least one of the descendants of the group.
        /// With $search=ChildrenOnly the API will return only the first level of children of the group entity info specified in $filter.  The user must have direct access to the children entities or one of it&apos;s descendants for it to show up in the results.
        /// </param>
        /// <param name="filter"> The filter parameter allows you to filter on the the name or display name fields. You can check for equality on the name field (e.g. name eq &apos;{entityName}&apos;)  and you can check for substrings on either the name or display name fields(e.g. contains(name, &apos;{substringToSearch}&apos;), contains(displayName, &apos;{substringToSearch&apos;)). Note that the &apos;{entityName}&apos; and &apos;{substringToSearch}&apos; fields are checked case insensitively. </param>
        /// <param name="view"> The view parameter allows clients to filter the type of data that is returned by the getEntities call. </param>
        /// <param name="groupName"> A filter which allows the get entities call to focus on a particular group (i.e. &quot;$filter=name eq &apos;groupName&apos;&quot;). </param>
        /// <param name="cacheControl"> Indicates whether the request should utilize any caches. Populate the header with &apos;no-cache&apos; value to bypass existing caches. </param>
        /// <param name="cancellationToken"> The cancellation token to use. </param>
        public async Task<Response<EntityListResult>> ListAsync(string skiptoken = null, int? skip = null, int? top = null, string select = null, Enum2? search = null, string filter = null, Enum3? view = null, string groupName = null, string cacheControl = null, CancellationToken cancellationToken = default)
        {
            using var message = CreateListRequest(skiptoken, skip, top, select, search, filter, view, groupName, cacheControl);
            await _pipeline.SendAsync(message, cancellationToken).ConfigureAwait(false);
            switch (message.Response.Status)
            {
                case 200:
                    {
                        EntityListResult value = default;
                        using var document = await JsonDocument.ParseAsync(message.Response.ContentStream, default, cancellationToken).ConfigureAwait(false);
                        value = EntityListResult.DeserializeEntityListResult(document.RootElement);
                        return Response.FromValue(value, message.Response);
                    }
                default:
                    throw await _clientDiagnostics.CreateRequestFailedExceptionAsync(message.Response).ConfigureAwait(false);
            }
        }

        /// <summary>
        /// List all entities (Management Groups, Subscriptions, etc.) for the authenticated user.
        /// 
        /// </summary>
        /// <param name="skiptoken">
        /// Page continuation token is only used if a previous operation returned a partial result. 
        /// If a previous response contains a nextLink element, the value of the nextLink element will include a token parameter that specifies a starting point to use for subsequent calls.
        /// 
        /// </param>
        /// <param name="skip"> Number of entities to skip over when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="top"> Number of elements to return when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="select"> This parameter specifies the fields to include in the response. Can include any combination of Name,DisplayName,Type,ParentDisplayNameChain,ParentChain, e.g. &apos;$select=Name,DisplayName,Type,ParentDisplayNameChain,ParentNameChain&apos;. When specified the $select parameter can override select in $skipToken. </param>
        /// <param name="search">
        /// The $search parameter is used in conjunction with the $filter parameter to return three different outputs depending on the parameter passed in. 
        /// With $search=AllowedParents the API will return the entity info of all groups that the requested entity will be able to reparent to as determined by the user&apos;s permissions.
        /// With $search=AllowedChildren the API will return the entity info of all entities that can be added as children of the requested entity.
        /// With $search=ParentAndFirstLevelChildren the API will return the parent and  first level of children that the user has either direct access to or indirect access via one of their descendants.
        /// With $search=ParentOnly the API will return only the group if the user has access to at least one of the descendants of the group.
        /// With $search=ChildrenOnly the API will return only the first level of children of the group entity info specified in $filter.  The user must have direct access to the children entities or one of it&apos;s descendants for it to show up in the results.
        /// </param>
        /// <param name="filter"> The filter parameter allows you to filter on the the name or display name fields. You can check for equality on the name field (e.g. name eq &apos;{entityName}&apos;)  and you can check for substrings on either the name or display name fields(e.g. contains(name, &apos;{substringToSearch}&apos;), contains(displayName, &apos;{substringToSearch&apos;)). Note that the &apos;{entityName}&apos; and &apos;{substringToSearch}&apos; fields are checked case insensitively. </param>
        /// <param name="view"> The view parameter allows clients to filter the type of data that is returned by the getEntities call. </param>
        /// <param name="groupName"> A filter which allows the get entities call to focus on a particular group (i.e. &quot;$filter=name eq &apos;groupName&apos;&quot;). </param>
        /// <param name="cacheControl"> Indicates whether the request should utilize any caches. Populate the header with &apos;no-cache&apos; value to bypass existing caches. </param>
        /// <param name="cancellationToken"> The cancellation token to use. </param>
        public Response<EntityListResult> List(string skiptoken = null, int? skip = null, int? top = null, string select = null, Enum2? search = null, string filter = null, Enum3? view = null, string groupName = null, string cacheControl = null, CancellationToken cancellationToken = default)
        {
            using var message = CreateListRequest(skiptoken, skip, top, select, search, filter, view, groupName, cacheControl);
            _pipeline.Send(message, cancellationToken);
            switch (message.Response.Status)
            {
                case 200:
                    {
                        EntityListResult value = default;
                        using var document = JsonDocument.Parse(message.Response.ContentStream);
                        value = EntityListResult.DeserializeEntityListResult(document.RootElement);
                        return Response.FromValue(value, message.Response);
                    }
                default:
                    throw _clientDiagnostics.CreateRequestFailedException(message.Response);
            }
        }

        internal HttpMessage CreateListNextPageRequest(string nextLink, string skiptoken, int? skip, int? top, string select, Enum2? search, string filter, Enum3? view, string groupName, string cacheControl)
        {
            var message = _pipeline.CreateMessage();
            var request = message.Request;
            request.Method = RequestMethod.Get;
            var uri = new RawRequestUriBuilder();
            uri.Reset(endpoint);
            uri.AppendRawNextLink(nextLink, false);
            request.Uri = uri;
            if (cacheControl != null)
            {
                request.Headers.Add("Cache-Control", cacheControl);
            }
            request.Headers.Add("Accept", "application/json");
            message.SetProperty("UserAgentOverride", _userAgent);
            return message;
        }

        /// <summary>
        /// List all entities (Management Groups, Subscriptions, etc.) for the authenticated user.
        /// 
        /// </summary>
        /// <param name="nextLink"> The URL to the next page of results. </param>
        /// <param name="skiptoken">
        /// Page continuation token is only used if a previous operation returned a partial result. 
        /// If a previous response contains a nextLink element, the value of the nextLink element will include a token parameter that specifies a starting point to use for subsequent calls.
        /// 
        /// </param>
        /// <param name="skip"> Number of entities to skip over when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="top"> Number of elements to return when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="select"> This parameter specifies the fields to include in the response. Can include any combination of Name,DisplayName,Type,ParentDisplayNameChain,ParentChain, e.g. &apos;$select=Name,DisplayName,Type,ParentDisplayNameChain,ParentNameChain&apos;. When specified the $select parameter can override select in $skipToken. </param>
        /// <param name="search">
        /// The $search parameter is used in conjunction with the $filter parameter to return three different outputs depending on the parameter passed in. 
        /// With $search=AllowedParents the API will return the entity info of all groups that the requested entity will be able to reparent to as determined by the user&apos;s permissions.
        /// With $search=AllowedChildren the API will return the entity info of all entities that can be added as children of the requested entity.
        /// With $search=ParentAndFirstLevelChildren the API will return the parent and  first level of children that the user has either direct access to or indirect access via one of their descendants.
        /// With $search=ParentOnly the API will return only the group if the user has access to at least one of the descendants of the group.
        /// With $search=ChildrenOnly the API will return only the first level of children of the group entity info specified in $filter.  The user must have direct access to the children entities or one of it&apos;s descendants for it to show up in the results.
        /// </param>
        /// <param name="filter"> The filter parameter allows you to filter on the the name or display name fields. You can check for equality on the name field (e.g. name eq &apos;{entityName}&apos;)  and you can check for substrings on either the name or display name fields(e.g. contains(name, &apos;{substringToSearch}&apos;), contains(displayName, &apos;{substringToSearch&apos;)). Note that the &apos;{entityName}&apos; and &apos;{substringToSearch}&apos; fields are checked case insensitively. </param>
        /// <param name="view"> The view parameter allows clients to filter the type of data that is returned by the getEntities call. </param>
        /// <param name="groupName"> A filter which allows the get entities call to focus on a particular group (i.e. &quot;$filter=name eq &apos;groupName&apos;&quot;). </param>
        /// <param name="cacheControl"> Indicates whether the request should utilize any caches. Populate the header with &apos;no-cache&apos; value to bypass existing caches. </param>
        /// <param name="cancellationToken"> The cancellation token to use. </param>
        /// <exception cref="ArgumentNullException"> <paramref name="nextLink"/> is null. </exception>
        public async Task<Response<EntityListResult>> ListNextPageAsync(string nextLink, string skiptoken = null, int? skip = null, int? top = null, string select = null, Enum2? search = null, string filter = null, Enum3? view = null, string groupName = null, string cacheControl = null, CancellationToken cancellationToken = default)
        {
            if (nextLink == null)
            {
                throw new ArgumentNullException(nameof(nextLink));
            }

            using var message = CreateListNextPageRequest(nextLink, skiptoken, skip, top, select, search, filter, view, groupName, cacheControl);
            await _pipeline.SendAsync(message, cancellationToken).ConfigureAwait(false);
            switch (message.Response.Status)
            {
                case 200:
                    {
                        EntityListResult value = default;
                        using var document = await JsonDocument.ParseAsync(message.Response.ContentStream, default, cancellationToken).ConfigureAwait(false);
                        value = EntityListResult.DeserializeEntityListResult(document.RootElement);
                        return Response.FromValue(value, message.Response);
                    }
                default:
                    throw await _clientDiagnostics.CreateRequestFailedExceptionAsync(message.Response).ConfigureAwait(false);
            }
        }

        /// <summary>
        /// List all entities (Management Groups, Subscriptions, etc.) for the authenticated user.
        /// 
        /// </summary>
        /// <param name="nextLink"> The URL to the next page of results. </param>
        /// <param name="skiptoken">
        /// Page continuation token is only used if a previous operation returned a partial result. 
        /// If a previous response contains a nextLink element, the value of the nextLink element will include a token parameter that specifies a starting point to use for subsequent calls.
        /// 
        /// </param>
        /// <param name="skip"> Number of entities to skip over when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="top"> Number of elements to return when retrieving results. Passing this in will override $skipToken. </param>
        /// <param name="select"> This parameter specifies the fields to include in the response. Can include any combination of Name,DisplayName,Type,ParentDisplayNameChain,ParentChain, e.g. &apos;$select=Name,DisplayName,Type,ParentDisplayNameChain,ParentNameChain&apos;. When specified the $select parameter can override select in $skipToken. </param>
        /// <param name="search">
        /// The $search parameter is used in conjunction with the $filter parameter to return three different outputs depending on the parameter passed in. 
        /// With $search=AllowedParents the API will return the entity info of all groups that the requested entity will be able to reparent to as determined by the user&apos;s permissions.
        /// With $search=AllowedChildren the API will return the entity info of all entities that can be added as children of the requested entity.
        /// With $search=ParentAndFirstLevelChildren the API will return the parent and  first level of children that the user has either direct access to or indirect access via one of their descendants.
        /// With $search=ParentOnly the API will return only the group if the user has access to at least one of the descendants of the group.
        /// With $search=ChildrenOnly the API will return only the first level of children of the group entity info specified in $filter.  The user must have direct access to the children entities or one of it&apos;s descendants for it to show up in the results.
        /// </param>
        /// <param name="filter"> The filter parameter allows you to filter on the the name or display name fields. You can check for equality on the name field (e.g. name eq &apos;{entityName}&apos;)  and you can check for substrings on either the name or display name fields(e.g. contains(name, &apos;{substringToSearch}&apos;), contains(displayName, &apos;{substringToSearch&apos;)). Note that the &apos;{entityName}&apos; and &apos;{substringToSearch}&apos; fields are checked case insensitively. </param>
        /// <param name="view"> The view parameter allows clients to filter the type of data that is returned by the getEntities call. </param>
        /// <param name="groupName"> A filter which allows the get entities call to focus on a particular group (i.e. &quot;$filter=name eq &apos;groupName&apos;&quot;). </param>
        /// <param name="cacheControl"> Indicates whether the request should utilize any caches. Populate the header with &apos;no-cache&apos; value to bypass existing caches. </param>
        /// <param name="cancellationToken"> The cancellation token to use. </param>
        /// <exception cref="ArgumentNullException"> <paramref name="nextLink"/> is null. </exception>
        public Response<EntityListResult> ListNextPage(string nextLink, string skiptoken = null, int? skip = null, int? top = null, string select = null, Enum2? search = null, string filter = null, Enum3? view = null, string groupName = null, string cacheControl = null, CancellationToken cancellationToken = default)
        {
            if (nextLink == null)
            {
                throw new ArgumentNullException(nameof(nextLink));
            }

            using var message = CreateListNextPageRequest(nextLink, skiptoken, skip, top, select, search, filter, view, groupName, cacheControl);
            _pipeline.Send(message, cancellationToken);
            switch (message.Response.Status)
            {
                case 200:
                    {
                        EntityListResult value = default;
                        using var document = JsonDocument.Parse(message.Response.ContentStream);
                        value = EntityListResult.DeserializeEntityListResult(document.RootElement);
                        return Response.FromValue(value, message.Response);
                    }
                default:
                    throw _clientDiagnostics.CreateRequestFailedException(message.Response);
            }
        }
    }
}
