trigger: none

extends:
  template: /eng/pipelines/templates/stages/archetype-sdk-tests.yml
  parameters:
    TimeoutInMinutes: 120
    ServiceDirectory: identity
    CloudConfig:
      Public:
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-test-resources)
          # Contains alternate tenant, AAD app and cert info for testing
          - $(sub-config-identity-test-resources)
    PreSteps:
      - pwsh: |
          [System.Convert]::FromBase64String($env:PFX_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/test.pfx -AsByteStream
          Set-Content -Path $(Agent.TempDirectory)/test.pem -Value $env:PEM_CONTENTS
          [System.Convert]::FromBase64String($env:SNI_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/testsni.pfx -AsByteStream
    EnvVars:
      IDENTITY_SP_CERT_PFX: $(Agent.TempDirectory)/test.pfx
      IDENTITY_SP_CERT_PEM: $(Agent.TempDirectory)/test.pem
      IDENTITY_SP_CERT_SNI: $(Agent.TempDirectory)/testsni.pfx
