trigger: none

extends:
  template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests-multiple.yml
  parameters:
    jobs:
      # Azure Cloud
      - ServiceDirectory: identity
        ScenarioName: AzureCloud  
        PreSteps:
          - pwsh: |
              [System.Convert]::FromBase64String($env:PFX_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/test.pfx -AsByteStream
              Set-Content -Path $(Agent.TempDirectory)/test.pem -Value $env:PEM_CONTENTS
              [System.Convert]::FromBase64String($env:SNI_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/testsni.pfx -AsByteStream
            env:
              PFX_CONTENTS: $(net-identity-spcert-pfx)
              PEM_CONTENTS: $(net-identity-spcert-pem)
              SNI_CONTENTS: $(net-identity-spcert-sni)
        EnvVars:
          AZURE_AUTHORITY_HOST: $(aad-azure-sdk-test-authority-uri)
          AZURE_KEYVAULT_SCOPE: "https://vault.azure.net/.default"
          AZURE_IDENTITY_TEST_TENANTID: $(net-identity-tenantid)
          AZURE_IDENTITY_TEST_USERNAME: $(net-identity-username)
          AZURE_IDENTITY_TEST_PASSWORD: $(net-identity-password)
          IDENTITY_SP_CLIENT_ID: $(net-identity-sp-clientid)
          IDENTITY_SP_TENANT_ID: $(net-identity-sp-tenantid)
          IDENTITY_SP_CLIENT_SECRET: $(net-identity-sp-clientsecret)
          IDENTITY_SP_CERT_PFX: $(Agent.TempDirectory)/test.pfx
          IDENTITY_SP_CERT_PEM: $(Agent.TempDirectory)/test.pem
          IDENTITY_SP_CERT_SNI: $(Agent.TempDirectory)/testsni.pfx

      # AzureUSGovernment
      - ServiceDirectory: identity
        ScenarioName: AzureUSGovernment
        PreSteps:
          - pwsh: |
              [System.Convert]::FromBase64String($env:PFX_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/test.pfx -AsByteStream
              Set-Content -Path $(Agent.TempDirectory)/test.pem -Value $env:PEM_CONTENTS
              [System.Convert]::FromBase64String($env:SNI_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/testsni.pfx -AsByteStream
            env:
              PFX_CONTENTS: $(net-identity-spcert-pfx-gov)
              PEM_CONTENTS: $(net-identity-spcert-pem-gov)
              SNI_CONTENTS: $(net-identity-spcert-sni)
        EnvVars:
          AZURE_AUTHORITY_HOST: $(aad-azure-sdk-test-authority-uri-gov)
          AZURE_KEYVAULT_SCOPE: "https://vault.usgovcloudapi.net/.default"
          AZURE_IDENTITY_TEST_TENANTID: $(net-identity-tenantid-gov)
          AZURE_IDENTITY_TEST_USERNAME: $(net-identity-username-gov)
          AZURE_IDENTITY_TEST_PASSWORD: $(net-identity-password-gov)
          IDENTITY_SP_CLIENT_ID: $(net-identity-sp-clientid-gov)
          IDENTITY_SP_TENANT_ID: $(net-identity-sp-tenantid-gov)
          IDENTITY_SP_CLIENT_SECRET: $(net-identity-sp-clientsecret-gov)
          IDENTITY_SP_CERT_PFX: $(Agent.TempDirectory)/test.pfx
          IDENTITY_SP_CERT_PEM: $(Agent.TempDirectory)/test.pem
          IDENTITY_SP_CERT_SNI: $(Agent.TempDirectory)/testsni.pfx

      # AzureChinaCloud
      - ServiceDirectory: identity
        ScenarioName: AzureChinaCloud  
        PreSteps:
          - pwsh: |
              [System.Convert]::FromBase64String($env:PFX_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/test.pfx -AsByteStream
              Set-Content -Path $(Agent.TempDirectory)/test.pem -Value $env:PEM_CONTENTS
              [System.Convert]::FromBase64String($env:SNI_CONTENTS) | Set-Content -Path $(Agent.TempDirectory)/testsni.pfx -AsByteStream
            env:
              PFX_CONTENTS: $(net-identity-spcert-pfx-cn)
              PEM_CONTENTS: $(net-identity-spcert-pem-cn)
              SNI_CONTENTS: $(net-identity-spcert-sni)
        EnvVars:
          AZURE_AUTHORITY_HOST: $(aad-azure-sdk-test-authority-uri-cn)
          AZURE_KEYVAULT_SCOPE: "https://vault.azure.cn/.default"
          AZURE_IDENTITY_TEST_TENANTID: $(net-identity-tenantid-cn)
          AZURE_IDENTITY_TEST_USERNAME: $(net-identity-username-cn)
          AZURE_IDENTITY_TEST_PASSWORD: $(net-identity-password-cn)
          IDENTITY_SP_CLIENT_ID: $(net-identity-sp-clientid-cn)
          IDENTITY_SP_TENANT_ID: $(net-identity-sp-tenantid-cn)
          IDENTITY_SP_CLIENT_SECRET: $(net-identity-sp-clientsecret-cn)
          IDENTITY_SP_CERT_PFX: $(Agent.TempDirectory)/test.pfx
          IDENTITY_SP_CERT_PEM: $(Agent.TempDirectory)/test.pem
          IDENTITY_SP_CERT_SNI: $(Agent.TempDirectory)/testsni.pfx
