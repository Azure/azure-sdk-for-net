// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// <auto-generated/>

#nullable disable

using System;
using System.IO;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using Azure.Core;

// CUSTOM CODE NOTE: The .NET emitter currently skips the second half of the 'ImageLocation | ImagePayload' union
//                   that should generate this class. It's implemented in custom code pending generation adjustment.

namespace Azure.AI.OpenAI
{
    /// <summary>
    ///     An individual image result, represented directly via base64-encoded image data.
    /// </summary>
    public partial class ImagePayload : ImageResponseItem
    {
        /// <summary>
        ///     Gets the base64-encoded text representation of a generated image.
        /// </summary>
        public ReadOnlyMemory<char> Base64Data { get; }

        internal ImagePayload(string base64JsonValue)
        {
            Argument.AssertNotNull(base64JsonValue, nameof(base64JsonValue));
            Base64Data = base64JsonValue.AsMemory();
        }

        /// <summary>
        ///     Gets a stream initialized over the encoded data in this payload's <see cref="Base64Data"/> member.
        /// </summary>
        /// <param name="cancellationToken">
        ///     A token that may be used to cancel the streaming operation. 
        /// </param>
        /// <returns> A stream encapsulating this response item's image data. </returns>
        public override Task<Stream> GetStreamAsync(CancellationToken cancellationToken = default)
        {
            byte[] dataAsBytes = Encoding.UTF8.GetBytes(Base64Data.ToArray());
            return Task.FromResult(new MemoryStream(dataAsBytes, writable: false) as Stream);
        }

        /// <summary>
        ///     Gets a stream initialized over the encoded data in this payload's <see cref="Base64Data"/> member.
        /// </summary>
        /// <param name="cancellationToken">
        ///     A token that may be used to cancel the streaming operation. 
        /// </param>
        /// <returns> A stream encapsulating this response item's image data. </returns>
        public override Stream GetStream(CancellationToken cancellationToken = default)
        {
            byte[] dataAsBytes = Encoding.UTF8.GetBytes(Base64Data.ToArray());
            return new MemoryStream(dataAsBytes, writable: false);
        }
    }
}
