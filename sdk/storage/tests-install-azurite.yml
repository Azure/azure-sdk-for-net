variables:
  azurite_location: $(Pipeline.Workspace)/.storage/azurite
  azurite_version: 3.11.0

steps:
  - task: Cache@2
    inputs:
      key: 'npm | "$(Agent.OS)" | $(azurite_version)
      path: $(azurite_location)
    displayName: Cache Azurite instalation
  - task: Npm@1
    inputs:
      command: custom
      customCommand: install --prefix $(azurite_location) azurite@$(azurite_version)
    displayName: Install Azurite
  - task: PowerShell@2
    displayName: Add Azurite location as environment variable
    inputs:
      targetType: 'inline'
      script: Write-Host "##vso[task.setvariable variable=Azure.Azurite.Location;]$(azurite_location)"
