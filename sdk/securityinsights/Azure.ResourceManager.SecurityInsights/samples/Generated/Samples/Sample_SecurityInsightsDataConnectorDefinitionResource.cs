// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// <auto-generated/>

#nullable disable

using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Azure.Core;
using Azure.Identity;
using Azure.ResourceManager.SecurityInsights.Models;

namespace Azure.ResourceManager.SecurityInsights.Samples
{
    public partial class Sample_SecurityInsightsDataConnectorDefinitionResource
    {
        // Get customize data connector definition
        [NUnit.Framework.Test]
        [NUnit.Framework.Ignore("Only verifying that the sample builds")]
        public async Task Get_GetCustomizeDataConnectorDefinition()
        {
            // Generated from example definition: specification/securityinsights/resource-manager/Microsoft.SecurityInsights/preview/2024-01-01-preview/examples/dataConnectorDefinitions/GetCustomizableDataConnectoeDefinitionById.json
            // this example is just showing the usage of "DataConnectorDefinitions_Get" operation, for the dependent resources, they will have to be created separately.

            // get your azure access token, for more details of how Azure SDK get your access token, please refer to https://learn.microsoft.com/en-us/dotnet/azure/sdk/authentication?tabs=command-line
            TokenCredential cred = new DefaultAzureCredential();
            // authenticate your client
            ArmClient client = new ArmClient(cred);

            // this example assumes you already have this SecurityInsightsDataConnectorDefinitionResource created on azure
            // for more information of creating SecurityInsightsDataConnectorDefinitionResource, please refer to the document of SecurityInsightsDataConnectorDefinitionResource
            string subscriptionId = "d0cfe6b2-9ac0-4464-9919-dccaee2e48c0";
            string resourceGroupName = "myRg";
            string workspaceName = "myWorkspace";
            string dataConnectorDefinitionName = "763f9fa1-c2d3-4fa2-93e9-bccd4899aa12";
            ResourceIdentifier securityInsightsDataConnectorDefinitionResourceId = SecurityInsightsDataConnectorDefinitionResource.CreateResourceIdentifier(subscriptionId, resourceGroupName, workspaceName, dataConnectorDefinitionName);
            SecurityInsightsDataConnectorDefinitionResource securityInsightsDataConnectorDefinition = client.GetSecurityInsightsDataConnectorDefinitionResource(securityInsightsDataConnectorDefinitionResourceId);

            // invoke the operation
            SecurityInsightsDataConnectorDefinitionResource result = await securityInsightsDataConnectorDefinition.GetAsync();

            // the variable result is a resource, you could call other operations on this instance as well
            // but just for demo, we get its data from this resource instance
            SecurityInsightsDataConnectorDefinitionData resourceData = result.Data;
            // for demo we just print out the id
            Console.WriteLine($"Succeeded on id: {resourceData.Id}");
        }

        // Create data connector definition
        [NUnit.Framework.Test]
        [NUnit.Framework.Ignore("Only verifying that the sample builds")]
        public async Task Update_CreateDataConnectorDefinition()
        {
            // Generated from example definition: specification/securityinsights/resource-manager/Microsoft.SecurityInsights/preview/2024-01-01-preview/examples/dataConnectorDefinitions/CreateCustomizableDataConnectorDefinition.json
            // this example is just showing the usage of "DataConnectorDefinitions_CreateOrUpdate" operation, for the dependent resources, they will have to be created separately.

            // get your azure access token, for more details of how Azure SDK get your access token, please refer to https://learn.microsoft.com/en-us/dotnet/azure/sdk/authentication?tabs=command-line
            TokenCredential cred = new DefaultAzureCredential();
            // authenticate your client
            ArmClient client = new ArmClient(cred);

            // this example assumes you already have this SecurityInsightsDataConnectorDefinitionResource created on azure
            // for more information of creating SecurityInsightsDataConnectorDefinitionResource, please refer to the document of SecurityInsightsDataConnectorDefinitionResource
            string subscriptionId = "d0cfe6b2-9ac0-4464-9919-dccaee2e48c0";
            string resourceGroupName = "myRg";
            string workspaceName = "myWorkspace";
            string dataConnectorDefinitionName = "73e01a99-5cd7-4139-a149-9f2736ff2ab5";
            ResourceIdentifier securityInsightsDataConnectorDefinitionResourceId = SecurityInsightsDataConnectorDefinitionResource.CreateResourceIdentifier(subscriptionId, resourceGroupName, workspaceName, dataConnectorDefinitionName);
            SecurityInsightsDataConnectorDefinitionResource securityInsightsDataConnectorDefinition = client.GetSecurityInsightsDataConnectorDefinitionResource(securityInsightsDataConnectorDefinitionResourceId);

            // invoke the operation
            SecurityInsightsDataConnectorDefinitionData data = new CustomizableConnectorDefinitionData()
            {
                ConnectorUiConfig = new CustomizableConnectorUiConfig("GitHub Enterprise Audit Log", "GitHub", "The GitHub audit log connector provides the capability to ingest GitHub logs into Azure Sentinel. By connecting GitHub audit logs into Azure Sentinel, you can view this data in workbooks, use it to create custom alerts, and improve your investigation process.", new ConnectorGraphQuery[]
            {
new ConnectorGraphQuery("Total events received","GitHub audit log events","GitHubAuditLogPolling_CL")
            }, new ConnectorDataType[]
            {
new ConnectorDataType("GitHubAuditLogPolling_CL","GitHubAuditLogPolling_CL \n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)")
            }, new ConnectorConnectivityCriterion[]
            {
new ConnectorConnectivityCriterion("IsConnectedQuery")
{
Value =
{
"GitHubAuditLogPolling_CL \n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(30d)"
},
}
            }, new ConnectorDefinitionsPermissions()
            {
                ResourceProvider =
            {
new ConnectorDefinitionsResourceProvider("Microsoft.OperationalInsights/workspaces","read and write permissions are required.","Workspace",ProviderPermissionsScope.Workspace,new ConnectorResourceProviderRequiredPermissions()
{
IsReadAction = false,
IsWriteAction = true,
IsDeleteAction = false,
IsCustomAction = false,
})
            },
                Customs =
            {
new CustomPermissionDetails("GitHub API personal token Key","You need access to GitHub personal token, the key should have 'admin:org' scope")
            },
            }, new InstructionStep[]
            {
new InstructionStep()
{
Title = "Connect GitHub Enterprise Audit Log to Azure Sentinel",
Description = "Enable GitHub audit Logs. \n Follow [this](https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token) to create or find your personal key",
Instructions =
{
new InstructionStepDetails(BinaryData.FromObjectAsJson(new Dictionary<string, object>()
{
["clientIdLabel"] = "Client ID",
["clientSecretLabel"] = "Client Secret",
["connectButtonLabel"] = "Connect",
["disconnectButtonLabel"] = "Disconnect"}),"OAuthForm")
},
}
            })
                {
                    Availability = new ConnectorDefinitionsAvailability()
                    {
                        Status = 1,
                        IsPreview = false,
                    },
                },
                ETag = new ETag("\"0300bf09-0000-0000-0000-5c37296e0000\""),
            };
            ArmOperation<SecurityInsightsDataConnectorDefinitionResource> lro = await securityInsightsDataConnectorDefinition.UpdateAsync(WaitUntil.Completed, data);
            SecurityInsightsDataConnectorDefinitionResource result = lro.Value;

            // the variable result is a resource, you could call other operations on this instance as well
            // but just for demo, we get its data from this resource instance
            SecurityInsightsDataConnectorDefinitionData resourceData = result.Data;
            // for demo we just print out the id
            Console.WriteLine($"Succeeded on id: {resourceData.Id}");
        }

        // Delete data connector definition
        [NUnit.Framework.Test]
        [NUnit.Framework.Ignore("Only verifying that the sample builds")]
        public async Task Delete_DeleteDataConnectorDefinition()
        {
            // Generated from example definition: specification/securityinsights/resource-manager/Microsoft.SecurityInsights/preview/2024-01-01-preview/examples/dataConnectorDefinitions/DeleteDataConnectorDefinitionById.json
            // this example is just showing the usage of "DataConnectorDefinitions_Delete" operation, for the dependent resources, they will have to be created separately.

            // get your azure access token, for more details of how Azure SDK get your access token, please refer to https://learn.microsoft.com/en-us/dotnet/azure/sdk/authentication?tabs=command-line
            TokenCredential cred = new DefaultAzureCredential();
            // authenticate your client
            ArmClient client = new ArmClient(cred);

            // this example assumes you already have this SecurityInsightsDataConnectorDefinitionResource created on azure
            // for more information of creating SecurityInsightsDataConnectorDefinitionResource, please refer to the document of SecurityInsightsDataConnectorDefinitionResource
            string subscriptionId = "d0cfe6b2-9ac0-4464-9919-dccaee2e48c0";
            string resourceGroupName = "myRg";
            string workspaceName = "myWorkspace";
            string dataConnectorDefinitionName = "73e01a99-5cd7-4139-a149-9f2736ff2ab5";
            ResourceIdentifier securityInsightsDataConnectorDefinitionResourceId = SecurityInsightsDataConnectorDefinitionResource.CreateResourceIdentifier(subscriptionId, resourceGroupName, workspaceName, dataConnectorDefinitionName);
            SecurityInsightsDataConnectorDefinitionResource securityInsightsDataConnectorDefinition = client.GetSecurityInsightsDataConnectorDefinitionResource(securityInsightsDataConnectorDefinitionResourceId);

            // invoke the operation
            await securityInsightsDataConnectorDefinition.DeleteAsync(WaitUntil.Completed);

            Console.WriteLine($"Succeeded");
        }
    }
}
