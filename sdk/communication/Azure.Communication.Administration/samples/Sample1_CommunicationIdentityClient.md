# Obtain user tokens from Azure Communication Services
This sample demonstrates how to obtain user tokens from Azure Communication Services. You can use this token to authenticate your users to use Azure Communication Services offerings. 

To get started you'll need an Azure Communication Services resource. See the README for prerequisites and instructions.
<!-- UPDATE ReadMe link -->

## Create a `CommunicationIdentityClient`

To create a new `CommunicationIdentityClient` you need a connection string to the Azure Communication Services resource that you can get from the Azure Portal once you create a relevant resource. 

You can set `connectionString` based on an environment variable, a configuration setting, or any way that works for your application.

```C# Snippet:CreateCommunicationIdentityClient
// Get a connection string to our Azure Communication resource.
var connectionString = "<connection_string>";
var client = new CommunicationIdentityClient(connectionString);
```

## Create a user
The `CommunicationIdentityClient` can be used to create users and issue tokens.

```C# Snippet:CreateCommunicationUser
Response<CommunicationUser> userResponse = client.CreateUser();
CommunicationUser user = userResponse.Value;
Console.WriteLine($"User id: {user.Id}");
```

You will need to store the `identity` that is returned by Azure Communication Services. This is necessary for creating tokens or refreshing them in the future and to map your user identities with Azure Communication Services identities. The `identity` value should be treated as a secret.

## Generate a user token

 <!---: TODO: Update the website address for explaining the scopes -->

In the example code snippet below, it is assumed that the token is generated for a user on your application. During token generation you should also pass list of scopes to Azure Communication Services,
so the token generated by Azure Communication Services is authorized only to do things determined by `scopes`. <!-- You can see the full list of scopes [here][scopes]. -->

Every token generated has an expiry date stamped on it. Once the token is expired, you can renew the token by calling the same method. 
```C# Snippet:CreateCommunicationToken
Response<CommunicationUserToken> tokenResponse = client.IssueToken(user, scopes: new[] { CommunicationTokenScope.Chat });
string token = tokenResponse.Value.Token;
DateTimeOffset expiresOn = tokenResponse.Value.ExpiresOn;
Console.WriteLine($"Token: {token}");
Console.WriteLine($"Expires On: {expiresOn}");
```

<!--
To see the full example source files, see:
* [Generate user token][GenerateUserTokenCode]
-->

<!-- LINKS -->
<!--[scopes](https://github.com/mikben/azure-docs-pr/blob/release-project-spool/articles/project-spool/concepts/identity-model.md)
[ReadMe](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/communication/Azure.Communication.Administration/samples/ReadMe.md)
[GenerateUserTokenCode](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/communication/Azure.Communication.Administration/tests/samples/Sample1_CommunicationIdentityClient.cs)

 -->