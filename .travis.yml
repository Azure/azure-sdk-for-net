matrix:
  include:
    - language: csharp
      stage: Mono ClientRuntime build
      mono: latest
      sudo: required
      dist: trusty
      script:
        - mono --version
        - ./getBuildTools.sh
        - nuget restore src/SdkCommon/ClientRuntime.sln -NoCache -OutputDirectory restoredPackages -Source https://api.nuget.org/v3/index.json
        - msbuild build.proj /t:build /p:Scope=SdkCommon/ClientRuntime
        - mono restoredPackages/xunit.runner.console/2.3.1/tools/net452/xunit.console.exe src/SdkCommon/ClientRuntime/Tests/ClientRuntime.FullDesktop.Tests/bin/Debug/net452/ClientRuntime.FullDesktop.Tests.dll
        - msbuild build.proj /t:build /p:Scope=SdkCommon/ClientRuntime.Azure
        - mono restoredPackages/xunit.runner.console/2.3.1/tools/net452/xunit.console.exe src/SdkCommon/ClientRuntime.Azure/Tests/CR.Azure.FullDesktop.Tests/bin/Debug/net452/CR.Azure.FullDesktop.Tests.dll
    - language: csharp
      stage: NetCore build for SDK repo
      mono: none
      sudo: required
      dist: trusty
      group: deprecated-2017Q4
      env:
          global:
              - DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
              - DOTNET_CLI_TELEMETRY_OPTOUT: 1
      # safelist
      #branches:
      #    only:
      #    - travisBuild
      addons:
        apt:
          sources:
          packages:
      install:
        - cat /etc/*release
        - sudo sh -c 'echo "deb [arch=amd64] https://apt-mo.trafficmanager.net/repos/dotnet-release/ trusty main" > /etc/apt/sources.list.d/dotnetdev.list'
        - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 417A0893
        - wget -q https://packages.microsoft.com/config/ubuntu/14.04/packages-microsoft-prod.deb
        - sudo dpkg -i packages-microsoft-prod.deb  
        - sudo apt-get update
        - sudo apt-get install dotnet-sdk-2.1.201
      script:
        - ./testSdkOnLinux.sh
      after_script:
        - echo "========== Server log: ============"
        - pwd
        - ls -al
        - ls -al TestResults
        - cat TestResults/*.log